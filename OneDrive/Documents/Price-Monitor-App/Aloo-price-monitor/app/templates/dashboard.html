{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card shadow-sm border-0 rounded-3">
            <div class="card-body p-4">
                <h4 class="card-title mb-4 fw-bold">Track New Item</h4>
                <form method="POST">
                    <div class="mb-3">
                        <label class="form-label text-secondary small text-uppercase fw-bold">Product URL</label>
                        <input type="url" name="url" class="form-control" placeholder="https://..." required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-secondary small text-uppercase fw-bold">Target Price</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" step="0.01" name="target_price" class="form-control" placeholder="50.00" required>
                        </div>
                        <div class="form-text">We'll email you when it drops below this.</div>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Start Tracking</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-8">
        <h4 class="mb-4 fw-bold">Your Watchlist</h4>
        
        {% if products %}
            <div class="row">
                {% for product in products %}
                <div class="col-12 mb-3">
                    <div class="card shadow-sm border-0 rounded-3 feature-card">
                        <div class="card-body d-flex justify-content-between align-items-center">
                            
                            <div style="max-width: 65%;">
                                <h6 class="fw-bold text-truncate mb-1">
                                    <a href="{{ product.url }}" target="_blank" class="text-decoration-none text-dark">{{ product.title }}</a>
                                </h6>
                                <p class="mb-0 small">
                                    Target: <span class="fw-bold">${{ product.target_price }}</span>
                                    
                                    {% if product.current_price %}
                                        <span class="ms-2 text-muted">| Current:</span>
                                        {% if product.current_price <= product.target_price %}
                                            <span class="badge bg-success">On Sale: ${{ product.current_price }}</span>
                                        {% else %}
                                            <span class="badge bg-secondary">${{ product.current_price }}</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="badge bg-warning text-dark">Pending...</span>
                                    {% endif %}
                                </p>
                            </div>

                            <div>
                                <a href="{{ product.url }}" target="_blank" class="btn btn-sm btn-outline-primary">View</a>
                                <a href="{{ url_for('main.delete_product', id=product.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Stop tracking this item?')">Stop</a>
                            </div>

                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="p-5 bg-light rounded-3 text-center border dashed-border">
                <p class="text-secondary mb-0">You aren't tracking any products yet.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}